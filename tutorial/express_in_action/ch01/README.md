# Expressとは何か

`Node.js`の特徴

- V8という高速なJavaScriptエンジンで実行
- 非同期コーディングスタイルを奨励
- APIは冗長的であり、定型的なコードが必要

`Node.js`はなぜ高速なのか

- 強力なJavaScriptエンジン
  - Google Chromeの場合はV8エンジン
  - ブラウザによって実行エンジンは異なる
- 同時実行（concurrency）の処理能力の高さ
  - 複数のリクエストが来た際に非同期に処理が可能
  - 非同期処理の代表格である、ブラウザイベントやI/Oイベントを非同期で処理可能

`Node.js`の処理速度の注意点

- シングルコアの性能をより引き出せる
- マルチコアの処理は優れていない

性能だけを考えるのであれば、PythonやRubyなどのスクリプト言語のほうが性能がいい場合もある。

`Node.js`を使用する利点は、やはりフロントエンドとバックエンドでプログラミング言語を統一することができる点である。

---

`Express`の特徴

- `Node.js`のAPIをより簡素にし、拡張性に優れたライブラリ
- ミドルウェアやルーティングを使って、APIをより簡単に整理可能

`Node.js`の振り返り

- `Node.js`内では、ブラウザのリクエストを処理するJavaScript関数をリクエストハンドラとして作成する
- 引数として、クライアントからのレスポンスと、サーバとしてのレスポンスを有している
- `Node.js`のHTTPサーバは、単にクライアントとリクエストハンドラ間の接続を処理するものである
- 問題点
  - 単一のリクエストハンドラを定義するため、APIが複雑になってしまうこと

`Express`が解決するもの

- `Node.js`では単一のリクエストハンドラを作成する必要があった
- `Express`では、HTTPサーバが受信するリクエストを受け入れ、処理ごとに個別に作成されている小さな関数に割り振る
- レスポンスを定義する際に、`Node.js`ではレスポンスオブジェクトに1つ1つ定義していたが、`Express`ではユーティリティ関数を作成し、簡易的に記述することが可能

`Express`の考え方

- `Express`は柔軟にアプリを構築するために、シンプルなAPIを提供しているライブラリ
- そのため多くの外部ライブラリを活用することが前提
- 開発者が、アプリのアーキテクチャやサードパーティモジュールの決定をする必要あり
- 要約するとミニマリストなフレームワークである

---

`Express`のコアな要素

- 4つの主要な機能がある
  - ミドルウェア
  - ルーティング
  - サブアプリケーション
  - 利便性

ミドルウェアとは

- 分解した小さなリクエストハンドラ関数、およびその塊
  - これをミドルウェア関数、ミドルウェアと呼ばれる
- リクエストのロギングやHTTPヘッダの設定、認証などのタスクを取り扱うことが可能
- チェーンのように処理をつないでいく
  - 例
    1. ロギングミドルウェア
    2. 認証ミドルウェア
    3. 対象ページを送信するミドルウェア
- 過去の遺産を活用して、セキュリティやユーザ認証、クッキー、セッション解析など、様々なミドルウェアが標準化されている

ルーティングとは

- ミドルウェアと同様に、リクエストハンドラをより小さなハンドラ関数に分解する
- ミドルウェアと異なり、リクエストハンドラはHTTPリクエストのURLとメソッドに応じて実行される
- つまりリクエストされた内容に応じて、リクエストハンドラを別個に分割して作成することで、アプリケーションの動作をルートごとに分離することが可能である

サブアプリケーションとは

- 大規模なアプリケーションコードを、小さく分割して管理することが可能なルーターを提供する
- 1つのExpressのアプリケーションコード
  - 管理アプリケーション用のルーター
  - API用のルーター
    - API/ver1用のルーター
    - API/ver2用のルーター
  - SPA用のルーター

利便性とは

- `Node.js`が提供していない便利機能
  - ファイルの送信
  - HTMLのレンダリング
  - クライアントのIPアドレス取得のような解析機能
  - etc

---

`Express`のエコシステム

- 様々なミドルウェアがすでに作成されている
- こうしたミドルウェアを組み合わせることで容易にアプリケーションを構築可能になる

`Express`とほかのフレームワークとの比較

- `Express`はHTTPサーバのみを取り扱う
- ライバルとしては`Hapl.js`
  - `Node.js`とは異なるアーキテクチャを構築することが目的
- 巨大なフルスタックフレームワークは`Meteor`
  - 厳格な構造に従って開発する必要あり
- `Express`はRubyの`sinatra`に影響されたらしい
- Pythonの`Bottle`や`Flask`にも似た構造である

`Express`を採用する動機

- `REST API`を使用することができる
- MEANスタックもあるが、依存関係にあるE(Express)、N(Node)以外は自由に選択できる
  - React、Vue、Angular
  - MySQL、MongoDB、PostgreSQL、etc
- WebSocketやWebRTCにも対応している


サードパーティ製ライブラリ

- `Express`専用のものや、`Node.js`用のライブラリなども使用できる
- HTMLのテンプレートライブラリも存在する
- `Node.js`用のテストライブラリも活用できる

---

- [参考資料](https://github.com/expressjs/express/tree/master/examples)